<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Mail Agent Demo</title>
  <style>body{font:14px/1.4 system-ui, sans-serif;max-width:720px;margin:2rem auto;padding:0 1rem}</style>
</head>
<body>
  <h1>Mail Agent Demo</h1>
  <label>To: <input id="to" value="andrecr6600@gmail.com" style="width:22rem"></label><br/>
  <label>Name: <input id="name" value="Andre" style="width:22rem"></label><br/><br/>
  <button id="preview">Preview</button>
  <button id="send">Send</button>
  <pre id="out" style="background:#111;color:#0f0;padding:1rem;white-space:pre-wrap"></pre>
<script>
  const API = 'http://localhost:8081';
  const base = {
    purpose: 'welcome', brand_id: 'default',
    context: { cta_text:'Visit CodeRoad', cta_url:'https://coderoad.com/' }
  };
  const out = document.getElementById('out');
  async function call(path){
    const payload = {
      ...base,
      recipient: { email: document.getElementById('to').value,
                   name: document.getElementById('name').value }
    };
    const r = await fetch(API+path, {
      method: 'POST',
      headers: { 'content-type':'application/json' },
      body: JSON.stringify(payload)
    });
    out.textContent = JSON.stringify(await r.json(), null, 2);
  }
  document.getElementById('preview').onclick = () => call('/mail/preview');
  document.getElementById('send').onclick = () => call('/mail/deliver');
</script>
</body>
</html>
<body>
  <h1>Mail Agent Demo</h1>
  <label>To: <input id="to" value="andrecr6600@gmail.com" style="width:22rem"></label><br/>
  <label>Name: <input id="name" value="Andre" style="width:22rem"></label><br/>
  <label>Instructions:<br/><textarea id="ins" rows=4 style="width:100%">Friendly tone. 2 short paragraphs. Mention our beta and free trial.</textarea></label><br/>
  <label>Mode: <select id="mode"><option>draft</option><option selected>send</option></select></label><br/><br/>
  <button id="preview">Preview</button>
  <button id="go">Approve â†’ Deliver</button>
  <pre id="out" style="background:#111;color:#0f0;padding:1rem;white-space:pre-wrap"></pre>
<script>
  const API = "http://localhost:8081";
  const base = {purpose:"welcome", brand_id:"default", context:{cta_text:"Visit CodeRoad", cta_url:"https://coderoad.com/"}};
  const out = document.getElementById("out");
  function payload(){
    const p = structuredClone(base);
    p.recipient = { email: document.getElementById("to").value, name: document.getElementById("name").value };
    p.context.instructions = document.getElementById("ins").value;
    return p;
  }
  document.getElementById("preview").onclick = async () => {
    const r = await fetch(API+"/mail/preview", {method:"POST", headers:{"content-type":"application/json"}, body: JSON.stringify(payload())});
    out.textContent = JSON.stringify(await r.json(), null, 2);
  };
  document.getElementById("go").onclick = async () => {
    const mode = document.getElementById("mode").value;
    const r = await fetch(API+"/mail/deliver?mode="+mode, {method:"POST", headers:{"content-type":"application/json"}, body: JSON.stringify(payload())});
    out.textContent = JSON.stringify(await r.json(), null, 2);
  };
</script>
</body>
